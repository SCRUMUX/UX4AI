<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>UX4AI ‚Äî UX –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–æ–≤</title>
<meta name="description" content="UX4AI: –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UX-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è AI-—Å–µ—Ä–≤–∏—Å–æ–≤. –ü—Ä–∞–∫—Ç–∏–∫–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –¥–µ–º–æ-—Å—Ü–µ–Ω—ã, –ø–æ–¥—Ö–æ–¥—ã –∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ò–ò."/>
<meta name="keywords" content="UX, AI, UX –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ò–ò, UX4AI"/>
<link rel="canonical" href="https://ux4ai.pro/"/>

<!-- Open Graph -->
<meta property="og:type" content="website"/>
<meta property="og:url" content="https://ux4ai.pro/"/>
<meta property="og:title" content="UX4AI ‚Äî UX –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–æ–≤"/>
<meta property="og:description" content="–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UX-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è AI-—Å–µ—Ä–≤–∏—Å–æ–≤. –ü—Ä–∞–∫—Ç–∏–∫–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –¥–µ–º–æ-—Å—Ü–µ–Ω—ã."/>
<meta property="og:image" content="https://ux4ai.pro/preview.png"/>

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="UX4AI ‚Äî UX –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–æ–≤"/>
<meta name="twitter:description" content="–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UX-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è AI-—Å–µ—Ä–≤–∏—Å–æ–≤. –ü—Ä–∞–∫—Ç–∏–∫–∞, –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –¥–µ–º–æ-—Å—Ü–µ–Ω—ã."/>
<meta name="twitter:image" content="https://ux4ai.pro/preview.png"/>

<!-- Verification (replace content values with real codes) -->
<meta name="google-site-verification" content="REPLACE_WITH_GOOGLE_CODE"/>
<meta name="yandex-verification" content="REPLACE_WITH_YANDEX_CODE"/>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105120842', 'ym');

    ym(105120842, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105120842" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<link rel="icon" type="image/png" href="./favicon.png"/>
<link rel="preload" href="./styles/variables.css" as="style"/>
<link rel="stylesheet" href="./styles/variables.css"/>
<!-- <link rel="preload" href="./styles/main.css" as="style"/> -->
<!-- <link rel="stylesheet" href="./styles/main.css"/> -->
<style>
    /* Scroll world: make body tall so camera flies segment-by-segment */
html {
  margin: 0;
  padding: 0;
  background: var(--bg);
  height: 100%;
  overflow-x: hidden;
  /* Establish consistent typography across the site: the base body text
     corresponds to Text/Body/Base (16px/24px) from the design system. */
  font-size: 16px;
  line-height: 1.5;
  font-weight: 400;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif;
}
body {
  margin: 0;
  padding: 0;
  background: transparent;
  color: var(--text);
}
    /* Height is set dynamically based on segments; keep minimal here */
    #three-container { 
      position:fixed; 
      inset:0; 
      overflow:hidden; 
      background: transparent;
      z-index: 1;
    }
    #labels {
      position: fixed; 
      inset: 0; 
      pointer-events: none;
      background: transparent;
      z-index: 900;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial;
    }
    .label {
      position:absolute; transform:translate(-50%,-50%);
      padding: 4px 10px;
      pointer-events: auto;
      font-size: 14px;
      letter-spacing: 0.2px;
      font-weight: 400;
      color: var(--text);
      background: rgba(18,23,34,0.85);
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: 0 0 0 1px rgba(36,48,65,0.4) inset, 0 2px 10px rgba(0,0,0,0.25);
      white-space: nowrap;
      opacity: 0.96;
    }

    .label:hover {
      background: rgba(36, 48, 65, 0.95);
      border-color: var(--accent);
      color: #CFE8FF;
      cursor: pointer;
    }
    /* HUD chips (layer hints) preserved for orientation */
    .hud {
      position: fixed; left: 12px; top: 12px; right: 12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;
      background:#121722cc; border:1px solid var(--border); border-radius:12px; padding:8px 10px; backdrop-filter: blur(6px);
      z-index:10; font-size:12px;
    }
    .chip { padding:4px 8px; border:1px solid #2a3b51; border-radius:10px; background:#162032; opacity:0.96; }
    .spacer{flex:1}
    .hint {opacity:0.7}

    /* Overlay backdrop for node details. This layer darkens the background when a
       node is selected and enables clicks outside of the panels to close the
       overlay. */
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.45);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 900;
    }
    /* Hide overlay on mobile when not active */
    @media (max-width: 479px) {
      #overlay:not(.active) {
        display: none !important;
      }
      body {
        background: transparent !important;
      }
    }
    #overlay.active {
      pointer-events: auto;
      opacity: 1;
    }
    /* Hide unused legacy panels by default */
    #object-icon, #big-panel, #small-panel {
      display: none;
    }
    /* Detached HUD elements for the clicked node */
    #hud-object-icon {
      position: fixed;
      top: 200px;
      left: 450px;
      right: auto;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: var(--accent); /* will be overridden with the node‚Äôs colour via JS */
      box-shadow: 0 0 20px rgba(91, 156, 255, 0.5);
      border: 3px solid var(--border);
      display: none;
      z-index: 1000;
    }
    #hud-big-panel {
      position: fixed;
      top: 200px;
      right: 450px;
      left: auto;
      width: 580px;
      height: auto;                    /* desktop: show full content */
      overflow-y: visible;             /* no inner scroll on desktop */
      overflow-x: hidden;            /* avoid nested horizontal scroll */
      background: rgba(18, 23, 34, 0.60);
      backdrop-filter: blur(8px);
      border: 1px solid #243041;
      border-radius: 12px;
      padding: 20px;
      color: #E6EEF8;
      line-height: 1.5;
      white-space: pre-line;
      box-sizing: border-box;        /* keep padding inside bounds */
      overflow-wrap: anywhere;       /* wrap long tokens */
      word-break: break-word;        /* break long words */
      font-weight: 200;
      display: none;
      z-index: 1000;
    }
    /* Ensure all text in big panel has consistent weight */
    #hud-big-panel * {
      font-weight: 200;
    }
    #hud-small-panel {
      position: fixed;
      top: 200px;
      left: 450px;
      right: auto;
      width: 250px;
      display: none;
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
      background: none;
      border: none;
      z-index: 1000;
    }
    #hud-small-panel, #hud-small-panel * { box-sizing: border-box; }
    /* Section header inside HUD (title, summary, prev/next) */
    #hud-small-panel .hud-section-header {
      width: 100%;
      text-align: left;
      color: #E6EEF8;
      background: rgba(18,23,34,0.60);
      border: 1px solid var(--border);
      border-radius: 8px;
      
    }
    /* Block B: reset positioning when panels are inside the container (desktop) */
    #hud-container #hud-small-panel { position: static; width: 280px; }
    #hud-container #hud-big-panel { position: static; width: 580px; }

    /* HUD Container: fixed, centered wrapper to mirror working layout */
    #hud-container {
      position: fixed;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      display: none;              /* controlled by JS */
      flex-direction: row;
      gap: 24px;
      z-index: 1000;
    }
    /* Inside container: refine child layouts matching working variant */
    #hud-container #hud-small-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: none;
      border: none;
    }
    #hud-container #hud-big-panel {
      height: auto;                    /* desktop (container mode): no inner scroll */
      overflow-y: visible;
      overflow-x: hidden;            /* avoid nested horizontal scroll */
      background: rgba(18, 23, 34, 0.60);
      border: 1px solid #243041;
      border-radius: 12px;
      padding: 20px;
      color: #E6EEF8;
      line-height: 1.5;
      white-space: pre-line;
      box-sizing: border-box;        /* keep padding inside bounds */
      overflow-wrap: anywhere;       /* wrap long tokens */
      word-break: break-word;        /* break long words */
    }
    #hud-small-panel .hud-section-title {
      margin: 0 0 6px 0;
      
      font-weight: 400;
      color: #CFE8FF;
    }
    #hud-small-panel .hud-section-summary {
      margin: 0 0 8px 0;
      
      line-height: 1.4;
      color: #9AA6B2;
    }
    #hud-small-panel .hud-section-nav {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    #hud-small-panel .hud-section-nav a {
      font-size: 12px;
      color: #9AA6B2;
      text-decoration: none;
      padding: 4px 6px;
      border-radius: 6px;
      transition: background 0.2s, color 0.2s;
    }
    #hud-small-panel .hud-section-nav a:hover {
      color: var(--accent);
      background: rgba(91,156,255,0.08);
    }
    #hud-small-panel button {
      padding: 10px;
      font-size: 14px;
      font-weight: 500;
      color: #9AA6B2;
      background: rgba(18, 23, 34, 0.80);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    
    /* Desktop: vertical layout */
    #hud-small-panel button {
      width: 100%;
    }
    
    /* Mobile: horizontal layout */
    @media (max-width: 479px) {
      #hud-small-panel {
        flex-direction: row !important;
        flex-wrap: wrap;
      }
      #hud-small-panel button {
        width: auto !important;
        flex: 1 1 auto !important;
        min-width: 0;
      }
    }
    #hud-small-panel button:hover {
      color: #5B9CFF;
      background: rgba(91, 156, 255, 0.08);
    }
    #hud-small-panel button.active-tab {
      color: #CFE8FF;
      background: rgba(91,156,255,0.12);
      border-color: #5B9CFF;
      box-shadow: 0 0 0 1px rgba(91,156,255,0.25) inset;
    }

    /* === Custom header, tagline and links panel for the portfolio site === */
    header#site-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 6px 14px;
      background: var(--panel-ghost);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(20px) saturate(160%);
      font-family: inherit;
    }
    /* Keep blur effect in HUD mode (reduced intensity for performance) */
    .hud-active header#site-header {
      backdrop-filter: blur(20px) saturate(160%);
      background: rgba(18,23,34,0.50);
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-logo .name {
      font-weight: 600;
      font-size: 18px;
      letter-spacing: 0.2px;
      color: #CFE8FF;
      white-space: nowrap;
    }
    .header-logo .tagline {
      margin-left: 12px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 400;
      white-space: nowrap;
    }
    .header-spacer { flex: 1; }
    .header-btn {
      padding: 4px 10px;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .header-btn:hover {
      color: var(--accent);
      background: rgba(91, 156, 255, 0.08);
    }
    .header-btn:active {
      color: #4A8AE6;
      background: rgba(91, 156, 255, 0.15);
    }
    /* === Custom header, tagline and links panel for the portfolio site === */
    /* Header styling improvements for the HUD */
    #hud-small-panel .hud-section-header {
      position: relative;
      padding: 12px;
      background: rgba(18,23,34,0.60);
      border: 1px solid #243041;
      border-radius: 8px;
    }
    #hud-small-panel .hud-section-title {
      margin: 0 0 4px 0;
      
      font-weight: 400;
      color: #CFE8FF;
    }
    #hud-small-panel .hud-section-summary {
      margin: 0 0 8px 0;
      
      line-height: 1.4;
      color: var(--muted);
    }
    #hud-small-panel .hud-section-nav {
      display: flex;
      gap: 8px;
      justify-content: flex-start;
    }
    #hud-small-panel .hud-section-nav a {
      flex: 1 1 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 8px;
      font-size: 12px;
      font-weight: 500;
      color: #5B9CFF;
      background: rgba(18, 23, 34, 0.80);
      border: 1px solid #243041;
      border-radius: 6px;
      text-decoration: none;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }
    #hud-small-panel .hud-section-nav a:hover {
      color: #CFE8FF;
      background: rgba(91,156,255,0.08);
      border-color: #5B9CFF;
    }
    /* Close button styling for the header */
    #hud-small-panel .hud-close-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 6px;
      font-size: 16px;
      font-weight: 600;
      color: #5B9CFF;
      background: rgba(18, 23, 34, 0.80);
      border: 1px solid #243041;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, border-color 0.2s;

      /* Ensure the close button remains a small icon rather than stretching like the tab buttons. */
      width: auto !important;
      height: auto !important;
      flex: 0 0 auto;
    }
    #hud-small-panel .hud-close-btn:hover {
      color: #CFE8FF;
      background: rgba(91,156,255,0.10);
      border-color: #5B9CFF;
    }

    /* Responsive layout for tablet screens: stack panels vertically */
    @media (max-width: 767px) {
      #hud-container {
        top: 120px;
        flex-direction: column;
        gap: 16px;
        width: 90%;
        overflow-y: auto;              /* tablet: scroll container */
      }
      #hud-container #hud-small-panel {
        width: 100%;
      }
      #hud-container #hud-big-panel { width: 100%; }
      #hud-small-panel .hud-section-title {
        font-size: 18px;
      }
      #hud-small-panel .hud-section-summary {
        font-size: 14px;
      }
      #hud-small-panel button {
        font-size: 15px;
      }
    }

    /* Responsive layout for mobile screens: further increase text sizes and
       allow the big panel to use more vertical space */
    @media (max-width: 479px) {
      #hud-container {
        top: 72px;
        width: 94%;
      }
      #hud-container #hud-big-panel { }
      #hud-small-panel .hud-section-title {
        font-size: 20px;
      }
      #hud-small-panel .hud-section-summary {
        font-size: 15px;
      }
    }
    /* Removed floating tagline; tagline now integrated with header logo */
    #links-panel {
      position: fixed;
      top: 90px;
      right: 24px;
      width: 280px;
      z-index: 1850;
      display: none;
      flex-direction: column;
      gap: 8px;
      padding: 12px 12px 10px 12px;
      /* Remove heavy backdrop: each quick link button will carry its own style. */
      background: none;
      border: none;
      border-radius: 12px;
    }
    .link-row a {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 400;
      /* Override inherited colour from body with !important to ensure the muted tone */
      color: var(--muted) !important;
      background: transparent;
      border: none;
      border-radius: 8px;
      transition: background 0.2s, color 0.2s;
    }
    .link-row a:hover {
      color: var(--accent) !important;
      background: rgba(91, 156, 255, 0.08);
    }
    .link-kicker {
      font-size: 12px;
      color: #9AA6B2;
      opacity: 0.75;
    }

    /* Close button for links panel */
    #links-panel .close-btn {
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 18px;
      color: #9AA6B2;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
    }
    #links-panel .close-btn:hover {
      color: #CFE8FF;
    }
    /* Ensure HUD buttons look slightly bolder: we already set weight via main
       declaration. This override is removed to avoid conflicting with the
       unified button styles. */
    /* Removed redundant HUD weight override */

    /* Orbit mode banner */
    #mode-banner {
      position: fixed;
      top: 56px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2100;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      color: #CFE8FF;
      background: rgba(18,23,34,0.80);
      border: 1px solid var(--border);
      border-radius: 10px;
      backdrop-filter: blur(8px);
      display: none;
      pointer-events: none;
    }
    /* Also remove blur on big HUD panels during HUD activity */
    .hud-active #hud-big-panel,
    .hud-active #hud-container #hud-big-panel {
      backdrop-filter: none !important;
    }
    /* HUD mode: square corners everywhere */
    .hud-active #hud-container,
    .hud-active #hud-container *,
    .hud-active #hud-small-panel,
    .hud-active #hud-small-panel *,
    .hud-active #hud-big-panel,
    .hud-active #hud-big-panel *,
    .hud-active .hud,
    .hud-active .hud * {
      border-radius: 0 !important;
    }
    /* Remove borders from all elements globally */
    body * { border: none !important; }
    /* In HUD mode render grid canvas below header and text panels, but above overlay */
    .hud-active #grid-canvas { z-index: 950 !important; pointer-events: none; }
    /* Default browser cursors in use */
    .hud-active button,
    .hud-active a,
    .hud-active input,
    .hud-active select,
    .hud-active textarea,
    .hud-active .chip,
    .hud-active .label,
    .hud-active .link-row a,
    .hud-active .btn,
    .hud-active .panel,
    .hud-active .card {
      border-radius: 0 !important;
    }

    

    
    /* HUD mode: square corners everywhere */
    .hud-active #hud-container,
    .hud-active #hud-container *,
    .hud-active #hud-small-panel,
    .hud-active #hud-small-panel *,
    .hud-active #hud-big-panel,
    .hud-active #hud-big-panel *,
    .hud-active .hud,
    .hud-active .hud * {
      border-radius: 0 !important;
    }
    .hud-active button,
    .hud-active a,
    .hud-active input,
    .hud-active select,
    .hud-active textarea,
    .hud-active .chip,
    .hud-active .label,
    .hud-active .link-row a,
    .hud-active .btn,
    .hud-active .panel,
    .hud-active .card {
      border-radius: 0 !important;
    }
  
/* === Strict overrides: no borders on HUD controls; mobile containment === */
#hud-small-panel .hud-section-nav a,
#hud-small-panel .hud-close-btn {
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
}
#hud-small-panel .hud-section-nav a:hover,
#hud-small-panel .hud-close-btn:hover {
  border: none !important;
  background: rgba(91,156,255,0.08) !important;
  color: #CFE8FF !important;
}
/* Big panel: contain within viewport; avoid horizontal overflow */
/* REMOVED to restore fixed desktop layout; container/mobile rules remain */
/*
#hud-big-panel {
  width: 100%;
  max-width: 100vw;
  height: auto;
  max-height: calc(100dvh - 260px);
  overflow-y: auto;
  overflow-x: hidden;
  box-sizing: border-box;
  overflow-wrap: anywhere;
  word-break: break-word;
}
*/
/* When big panel is inside the responsive container */
/*
#hud-container #hud-big-panel {
  width: 100%;
  max-width: 100vw;
  height: auto;
  max-height: calc(100dvh - 260px);
  overflow-y: auto;
  overflow-x: hidden;
  box-sizing: border-box;
  overflow-wrap: anywhere;
  word-break: break-word;
}
*/
/* Tablet */
@media (max-width: 767px) {
  /* removed duplicate - using mobile styles from line 740 */
}
/* Mobile */
@media (max-width: 479px) {
  /* Show orbit toggle on mobile */
  #mobile-orbit-toggle {
    display: flex !important;
  }
}


/* === Patch: keep Prev/Next on one line === */
#hud-small-panel .hud-section-nav {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  flex-wrap: nowrap; /* do not wrap to second line */
}
#hud-small-panel .hud-section-nav a {
  flex: 0 0 auto !important;   /* don't stretch, don't wrap */
  white-space: nowrap !important;
  padding: 2px 6px !important;  /* tighter to fit in one row */
  line-height: 1.1 !important;
}

/* Mobile orbit mode toggle */
#mobile-orbit-toggle {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 900;
  display: flex;
}

#toggle-orbit-btn {
  background: rgba(18, 23, 34, 0.85);
      border: 1px solid var(--border);
  border-radius: 10px;
  padding: 8px 14px;
      color: var(--text);
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 0 0 1px rgba(36,48,65,0.4) inset, 0 2px 10px rgba(0,0,0,0.25);
  white-space: nowrap;
  opacity: 0.96;
}

#toggle-orbit-btn:hover {
  background: rgba(36, 48, 65, 0.95);
  border-color: #5B9CFF;
  color: #CFE8FF;
}

#toggle-orbit-btn.active {
  background: rgba(91, 156, 255, 0.15);
  border-color: #5B9CFF;
  color: #5B9CFF;
}

#toggle-orbit-btn.active:hover {
  border-color: #4A8AE6;
  color: #CFE8FF;
}

#toggle-orbit-icon {
  width: 24px;
  height: 24px;
  display: block;
  filter: brightness(0) saturate(100%) invert(65%) sepia(8%) saturate(443%) hue-rotate(177deg) brightness(94%) contrast(92%);
  transition: filter 200ms ease;
}

/* Active orbit mode: tint icon to accent blue */
#toggle-orbit-btn.active #toggle-orbit-icon {
  filter: brightness(0) saturate(100%) invert(42%) sepia(66%) saturate(1675%) hue-rotate(189deg) brightness(101%) contrast(98%);
}

/* Disable smooth scroll globally */
html {
  scroll-behavior: auto;
}

@media (max-width: 479px) {
  #hud-small-panel .hud-section-nav a { font-size: 12px !important; }
}


/* === Mobile: scroll the HUD container instead of the big panel to guarantee bottom visibility === */
@media (max-width: 479px) {
  #hud-container {
    top: 58px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 94% !important;
    height: auto !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding-bottom: 24px !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain !important;
    /* hide scrollbar on mobile */
    scrollbar-width: none;
  }
  #hud-container::-webkit-scrollbar { width: 0; height: 0; }
  #hud-container #hud-big-panel {
    height: auto !important;
    max-height: none !important;
    overflow: visible !important;
    padding-bottom: 40px !important;
  }
  /* Prev/Next: keep one line on very narrow devices */
  #hud-small-panel .hud-section-nav a {
    font-size: 12px !important;
    padding: 2px 6px !important;
    white-space: nowrap !important;
    flex: 0 0 auto !important;
    line-height: 1.1 !important;
  }
}

/* Ultra-narrow safeguard */
@media (max-width: 360px) {
  #hud-small-panel .hud-section-nav a {
    font-size: 11px !important;
    padding: 2px 4px !important;
  }
}


@media (max-width: 479px) {
  #btn-demo { display: none !important; }
}


/* Mobile header: hide logo, left-align '–û–±–æ –º–Ω–µ' and '–°—Å—ã–ª–∫–∏' */
@media (max-width: 479px) {
  header#site-header { justify-content: flex-start !important; gap: 8px !important; }
  header#site-header .header-logo { display: none !important; }
  header#site-header .header-spacer { display: none !important; }
  #btn-demo { display: none !important; }
  .header-btn { padding: 6px 10px !important; }
}


/* Mobile: show '–°–º–æ—Ç—Ä–µ—Ç—å –¥–µ–º–æ' and keep buttons left-aligned */
@media (max-width: 479px) {
  #btn-demo { display: inline-flex !important; }
  header#site-header { justify-content: flex-start !important; gap: 8px !important; }
  .header-btn { padding: 6px 10px !important; }
}


/* === HUD title font refinement === */
#hud-small-panel .hud-section-title {
  font-weight: 400 !important;  /* same weight as labels for consistency */
  font-size: 15px !important;
  letter-spacing: 0.2px;
}
#hud-small-panel .hud-section-summary {
  font-weight: 400 !important;
  font-size: 14px !important;
  color: #A5B4C3 !important;
}


/* === Tablet: mirror mobile behavior (container scroll, tail always reachable) === */
@media (max-width: 767px) {
  #hud-container {
    top: 58px !important;
    bottom: 12px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 94% !important;
    height: auto !important;
    max-height: none !important;
    overflow-y: auto !important;          /* scroll on container */
    overflow-x: hidden !important;
    padding-bottom: 24px !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain !important;
    /* hide scrollbar on tablet */
    scrollbar-width: none;
  }
  #hud-container::-webkit-scrollbar { width: 0; height: 0; }
  #hud-container #hud-big-panel {
    width: 100% !important;
    max-width: 100vw !important;
    height: auto !important;
    max-height: none !important;          /* let it grow; container handles scroll */
    overflow: visible !important;
    padding-bottom: 16px !important;      /* ensure last line/link is not cut */
    box-sizing: border-box !important;
    overflow-wrap: anywhere !important;
    word-break: break-word !important;
  }
  /* Keep Prev/Next in one row on tablet too */
  #hud-small-panel .hud-section-nav {
    flex-wrap: nowrap !important;
  }
  #hud-small-panel .hud-section-nav a {
    flex: 0 0 auto !important;
    white-space: nowrap !important;
    padding: 3px 8px !important;
    line-height: 1.1 !important;
    font-size: 13px !important;
  }
}


/* === Tablet header: show only logo (no tagline) and buttons === */
@media (min-width: 480px) and (max-width: 767px) {
  header#site-header { justify-content: space-between !important; gap: 12px !important; }
  header#site-header .header-logo { display: flex !important; align-items: center !important; }
  header#site-header .header-logo .tagline { display: none !important; } /* —É–±—Ä–∞—Ç—å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ */
  /* –ö–Ω–æ–ø–∫–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É, –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
  .header-btn { padding: 8px 12px !important; }
  #btn-demo { display: inline-flex !important; } /* –¥–µ–º–æ –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∏–¥–∏–º–æ–π */
}


/* === Unified thin dark scrollbars (mobile-like) === */
html, body { scrollbar-gutter: stable; }

/* Firefox */
html, body,
#overlay, #hud-big-panel {
  scrollbar-width: thin;
  scrollbar-color: #3B4A5F transparent;
}

/* Chromium/WebKit */
html::-webkit-scrollbar,
body::-webkit-scrollbar,
#overlay::-webkit-scrollbar,
#hud-big-panel::-webkit-scrollbar { width: 8px; height: 8px; }

html::-webkit-scrollbar-track,
body::-webkit-scrollbar-track,
#overlay::-webkit-scrollbar-track,
#hud-big-panel::-webkit-scrollbar-track { background: transparent; }

html::-webkit-scrollbar-thumb,
body::-webkit-scrollbar-thumb,
#overlay::-webkit-scrollbar-thumb,
#hud-big-panel::-webkit-scrollbar-thumb {
  background: rgba(59, 74, 95, 0.9);
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

#overlay:hover::-webkit-scrollbar-thumb,
#hud-big-panel:hover::-webkit-scrollbar-thumb,
html:hover::-webkit-scrollbar-thumb,
body:hover::-webkit-scrollbar-thumb {
  background: rgba(59, 74, 95, 1);
}

/* === HUD Grid hologram effect === */
.grid-line {
  pointer-events: none;
  /* dashed via repeating gradient; color set via --c */
  --c: var(--grid-color, rgba(92, 182, 255, 0.18));
  --dash: 10px;   /* length of visible segment */
  --gap: 8px;     /* length of gap */
  --phase: 0px;   /* starting offset */
  background: none;
  box-shadow:
    0 0 3px rgba(92, 182, 255, 0.22),
    0 0 8px rgba(92, 182, 255, 0.14);
  mix-blend-mode: screen;
  opacity: var(--grid-opacity, 0.85);
  filter: hue-rotate(var(--grid-hue, 0deg)) saturate(var(--grid-sat, 1.1));
  will-change: opacity, filter, transform, background-position;
}
.grid-line::after {
  content: '';
  position: absolute; inset: 0;
  pointer-events: none;
}
.grid-line.h { /* horizontal dashed */
  background-image: repeating-linear-gradient(
    90deg,
    var(--c) 0 calc(var(--dash)),
    rgba(255,255,255,0) calc(var(--dash)) calc(calc(var(--dash) + var(--gap)))
  );
  background-size: calc(var(--dash) + var(--gap)) 100%;
  background-position: var(--phase, 0px) 0;
}
.grid-line.h::after {
  /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è: –ª—ë–≥–∫–∏–π –±–µ–≥—É—â–∏–π –±–ª–∏–∫ */
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(200,240,255,0.35) 50%, rgba(255,255,255,0) 100%);
  background-size: 220% 100%;
  background-position: var(--shimmerH, 0%) 0;
}
.grid-line.v { /* vertical dashed */
  background-image: repeating-linear-gradient(
    180deg,
    var(--c) 0 calc(var(--dash)),
    rgba(255,255,255,0) calc(var(--dash)) calc(calc(var(--dash) + var(--gap)))
  );
  background-size: 100% calc(var(--dash) + var(--gap));
  background-position: 0 var(--phase, 0px);
}
.grid-line.v::after {
  /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è: –±–ª–∏–∫ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ */
  background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(200,240,255,0.35) 50%, rgba(255,255,255,0) 100%);
  background-size: 100% 220%;
  background-position: 0 var(--shimmerV, 0%);
}
/* –£–±—Ä–∞–Ω—ã CSS-–∞–Ω–∏–º–∞—Ü–∏–∏; –∑–Ω–∞—á–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏–∑ –¥–≤–∏–∂–∫–∞ —á–µ—Ä–µ–∑ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */

/* Final override: hide container scrollbar on mobile/tablet (Chromium/WebKit + Firefox) */
@media (max-width: 767px) {
  #hud-container { scrollbar-width: none !important; }
  #hud-container::-webkit-scrollbar { width: 0 !important; height: 0 !important; }
  #hud-container::-webkit-scrollbar-thumb { background: transparent !important; }
  #hud-container { scrollbar-gutter: auto; }
}


/* remove stray flex override; container visibility controlled above */

/* === Header buttons default spacing via .header-spacer (override removed) === */

/* (Reset rules are defined once above; duplicates removed) */

</style>
</head>
<body>

<!-- Header -->
<header id="site-header">
  <div class="header-logo">
    <span class="name">–í–ª–∞–¥–∏–º–∏—Ä –ö–æ—Å—Ç—è–ª</span>
    <span class="tagline">–ø—Ä–æ–µ–∫—Ç–∏—Ä—É—é UX –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è AI —Å–µ—Ä–≤–∏—Å–æ–≤</span>
  </div>
  <div class="header-spacer"></div>
  <button class="header-btn" id="btn-about">–û–±–æ –º–Ω–µ</button>
  <button class="header-btn" id="btn-links">–°—Å—ã–ª–∫–∏</button>
  <button class="header-btn" id="btn-demo">–°–º–æ—Ç—Ä–µ—Ç—å –¥–µ–º–æ</button>
  <div id="theme-toggle-container"></div>
  <select id="theme-select" style="display:none;">
    <option value="calm">Calm</option>
    <option value="matrix">Matrix</option>
  </select>
</header>

<!-- Mode banner -->
<div id="mode-banner">–†–µ–∂–∏–º: –û—Ä–±–∏—Ç–∞ (ESC ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—é)</div>

<!-- Mobile orbit mode toggle -->
<div id="mobile-orbit-toggle" style="display: none;">
  <button id="toggle-orbit-btn">
    <img id="toggle-orbit-icon" src="./camera_24dp_434343_FILL0_wght400_GRAD0_opsz24.svg" alt="Camera" />
  </button>
</div>

<!-- Links panel -->
<div id="links-panel">
  <button class="close-btn" id="btn-links-close">‚úï</button>
  <div class="link-row"><a href="#" id="lnk-tg-chat" target="_blank">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram</a></div>
  <div class="link-row"><a href="#" id="lnk-tg-community" target="_blank">üë• –ü–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</a></div>
  <div class="link-row"><a href="#" id="lnk-resume" target="_blank">üìÑ –†–µ–∑—é–º–µ (PDF)</a></div>
  <div class="link-kicker">–í—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.</div>
</div>

<!-- Canvas and labels -->
<div id="three-container"></div>
<div id="labels"></div>

<!-- HUD elements -->
<div id="overlay"></div>

<div id="hud-object-icon"></div>
<!-- Wrap the HUD panels inside a container so they can be centred and stacked responsively -->
<div id="hud-container">
  <div id="hud-small-panel">
    <button data-index="0">–í–∞—Ä–∏–∞–Ω—Ç 1</button>
    <button data-index="1">–í–∞—Ä–∏–∞–Ω—Ç 2</button>
    <button data-index="2">–í–∞—Ä–∏–∞–Ω—Ç 3</button>
          </div>
  <div id="hud-big-panel"></div>
        </div>

  <!-- Grid overlay (thin through-borders that form the HUD grid) -->
  <div id="grid-overlay" aria-hidden="true"></div>
  <canvas id="grid-canvas" aria-hidden="true"></canvas>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.152.2/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.152.2/examples/jsm/"
  }
}
</script>
<script type="module">
async function init() {
  try {
    console.log('[Bootstrap] Importing THREE via importmap...');
    const THREE = await import('three');
    console.log('‚úì THREE imported');
    
    // Make available globally for modules
    window.THREE = THREE;
    
    console.log('[Bootstrap] Importing modules...');
    const { createEngine } = await import('./core/engine.js?v=37');
    const { initThemeSwitcher } = await import('./ui/themeSwitcher.js?v=37');
    const { initHUD } = await import('./core/hud-manager.js?v=37');
    
    console.log('[Bootstrap] Creating engine...');
    const engine = createEngine({
      canvasParent: document.getElementById('three-container'),
      labelsElement: document.getElementById('labels')
    });
    // Expose engine for grid overlay to query current scene state
    try { window._engine = engine; } catch(_) {}
    
    console.log('[Bootstrap] Initializing theme switcher...');
    initThemeSwitcher(engine);
    
    // Listen for theme mounted event and then initialize HUD
    let hud = null;
    engine.on('themeMounted', () => {
      if (!hud) {
        hud = initHUD({
          overlay: document.getElementById('overlay'),
          hudObjectIcon: document.getElementById('hud-object-icon'),
          hudBigPanel: document.getElementById('hud-big-panel'),
          hudSmallPanel: document.getElementById('hud-small-panel'),
          hudContainer: document.getElementById('hud-container'),
          labelsLayer: document.getElementById('labels'),
          btnAbout: document.getElementById('btn-about'),
          btnLinks: document.getElementById('btn-links'),
          btnDemo: document.getElementById('btn-demo'),
          linksPanel: document.getElementById('links-panel'),
          btnLinksClose: document.getElementById('btn-links-close')
        });
      }
    });
    
    console.log('[Bootstrap] ‚úÖ Ready!');

    // Ensure any prior custom cursor element is removed
    try { const old = document.getElementById('custom-cursor'); if (old) old.remove(); } catch(_) {}

    // -------- HUD Grid (through-borders) ----------
    // Renders 1px lines across the whole viewport at the edges of HUD panels.
    const GRID_COLOR = 'rgba(120, 220, 255, 0.25)';
    const overlay = document.getElementById('grid-overlay');
    overlay.style.position = 'fixed';
    overlay.style.inset = '0';
    overlay.style.pointerEvents = 'none';
    overlay.style.zIndex = '850'; // above scene, below labels/HUD
    // Disable DOM-line overlay; we will draw via canvas for reliable animation
    overlay.style.display = 'none';

    // Canvas grid overlay (reliable, animated in sync with core pulse)
    const canvas = document.getElementById('grid-canvas');
    canvas.style.position = 'fixed';
    canvas.style.inset = '0';
    canvas.style.pointerEvents = 'none';
    canvas.style.zIndex = '850';
    // Grid only active in HUD mode
    function isGridActive() {
      const root = document.documentElement;
      return root.classList.contains('hud-active') || root.classList.contains('links-active');
    }
    var GRID_SIMPLE = false; // bind to Calm wireframe
    let ctx = canvas.getContext('2d');
    // Flicker state synced to Calm intensity
    var _flicker = {
      lastI: 0,
      peaks: [], // {t0, dur, amp}
      activeUntil: 0,
      seed: Math.random()*1000
    };

    const LINE_THICK = 1; // px
    const targetsSelectors = [
      '#site-header',
      '#links-panel',
      '#hud-container',
      '#hud-small-panel',
      '#hud-big-panel',
      '#mobile-orbit-toggle'
    ];

    function clearLines() {
      while (overlay.firstChild) overlay.removeChild(overlay.firstChild);
    }

    function addLine(x, y, w, h) {
      const dpr = window.devicePixelRatio || 1;
      const el = document.createElement('div');
      el.style.position = 'absolute';
      el.style.left = Math.floor(x) + 'px';
      el.style.top = Math.floor(y) + 'px';
      el.style.width = w + 'px';
      el.style.height = h + 'px';
      el.className = 'grid-line ' + (h === 1 ? 'h' : 'v');
      // randomize dash/gap/phase so lines are desynchronized
      const rand = (min, max) => Math.random() * (max - min) + min;
      const dash = Math.round(rand(6, 14));
      const gap = Math.round(rand(6, 12));
      const phase = Math.round(rand(0, dash + gap));
      el.style.setProperty('--dash', dash + 'px');
      el.style.setProperty('--gap', gap + 'px');
      el.style.setProperty('--phase', phase + 'px');
      // crisp lines on fractional edges and high-DPI
      const fx = x - Math.floor(x);
      const fy = y - Math.floor(y);
      let tx = 0, ty = 0;
      if (Math.abs(fx - 0.5) < 0.26) tx = 0.5; // snap ~*.5px
      if (Math.abs(fy - 0.5) < 0.26) ty = 0.5;
      // On odd DPR physically shift lines by half pixel to sit on device pixel grid
      if (dpr % 2 !== 0) {
        if (w === 1) tx = tx || 0.5;
        if (h === 1) ty = ty || 0.5;
      }
      if (tx || ty) el.style.transform = `translate(${tx}px, ${ty}px)`;
      overlay.appendChild(el);
    }

    // Cache arrays for canvas drawing (declared early so buildGrid can fill them)
    let cachedXs = [], cachedYs = [], lineSeeds = new Map();
    let lineDirsX = [], lineDirsY = [];
    let prevFlashActive = false;
    // (grid cursor crosshair disabled)

    function buildGrid() {
      if (!isGridActive()) return;
      clearLines();
      const rects = [];
      targetsSelectors.forEach(sel => {
        const el = document.querySelector(sel);
        if (!el) return;
        const r = el.getBoundingClientRect();
        if (r.width > 0 && r.height > 0) rects.push(r);
        // —Ç–∞–∫–∂–µ —É—á–µ—Å—Ç—å –ø—Ä—è–º—ã—Ö –¥–µ—Ç–µ–π (—Å—Ç—Ä–æ–∫–∏/–∫–∞—Ä—Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ –º–∞–ª–æ–≥–æ HUD)
        if (el.id === 'hud-small-panel') {
          el.childNodes.forEach(n => {
            if (n.nodeType !== 1) return;
            const rr = n.getBoundingClientRect();
            if (rr.width > 0 && rr.height > 0) rects.push(rr);
          });
        }
      });
      if (rects.length === 0) return;

      // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ X/Y –∫—Ä–∞—ë–≤
      const xs = new Set();
      const ys = new Set();
      rects.forEach(r => {
        const left = r.left;
        const right = r.right - LINE_THICK;   // align to the visible right border
        const top = r.top;
        const bottom = r.bottom - LINE_THICK; // align to the visible bottom border
        xs.add(left);
        xs.add(right);
        ys.add(top);
        ys.add(bottom);
      });

      const vw = window.innerWidth;
      const vh = window.innerHeight;
      // Compute canvas size with device pixel ratio for crisp 1px strokes
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(vw * dpr);
      canvas.height = Math.floor(vh * dpr);
      canvas.style.width = vw + 'px';
      canvas.style.height = vh + 'px';
      ctx = canvas.getContext('2d');
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      // Cache edges for canvas drawing
      // Exclude the area next to the scrollbar (avoid rightmost vertical line)
      const rightGutter = 18; // ~scrollbar width on Win
      cachedXs = Array.from(xs).sort((a,b)=>a-b).filter(x => x > 0.5 && x < (vw - rightGutter));
      cachedYs = Array.from(ys).sort((a,b)=>a-b).filter(y => y > 0.5 && y < vh - 0.5);
      // assign random dash settings per line for desync
      lineSeeds = new Map();
      cachedXs.forEach((x,i)=> lineSeeds.set('x'+i, Math.random()));
      cachedYs.forEach((y,i)=> lineSeeds.set('y'+i, Math.random()));
      // initialize directions (+1/-1) per line
      lineDirsX = cachedXs.map(()=> (Math.random()<0.5? -1: 1));
      lineDirsY = cachedYs.map(()=> (Math.random()<0.5? -1: 1));
      drawCanvasGrid(0);
    }

    // –†–∏—Å—É–µ–º –ø–æ—Å–ª–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–º—ã (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–∫—Ç–æ–≤, —á—Ç–æ–±—ã —Å—Ö–≤–∞—Ç–∏—Ç—å –ø–æ–∑–¥–Ω–∏–µ —Ä–∞–∑–º–µ—Ä—ã)
    function scheduleBuildBurst() {
      buildGrid();
      requestAnimationFrame(buildGrid);
      setTimeout(buildGrid, 50);
      setTimeout(buildGrid, 150);
    }
    engine.on('themeMounted', () => {
      scheduleBuildBurst();
    });

    // Initial draw at startup (before any theme mounts) so Calm/Matrix both show lines
    scheduleBuildBurst();

    // --- Canvas drawing loop ---
    // Listen for Calm scene pulse events
    var pulseHueDeg = 200; var pulseUntilMs = 0; var forceStepUntilMs = 0;
    var pulseIntensity = null; // 0..1 from Calm
    // Synthetic flicker (working baseline): fast sine + noisy threshold, no scheduler
    var flashLevel = 0.12; // current alpha
    var lastMs = (typeof performance !== 'undefined') ? performance.now() : Date.now();
    var noiseSeed = Math.random()*1000;
    try {
      window.addEventListener('calmPulse', (e) => {
        const now = (typeof performance !== 'undefined') ? performance.now() : Date.now();
        const detail = (e && e.detail) || {};
        const hueDeg = (typeof detail.hueDeg === 'number') ? detail.hueDeg : 200;
        const inten = (typeof detail.intensity === 'number') ? Math.max(0, Math.min(1, detail.intensity)) : null;
        pulseHueDeg = hueDeg;
        pulseIntensity = inten;
        pulseUntilMs = now + 320; // longer 320ms flash for visibility
        forceStepUntilMs = pulseUntilMs;
      });
    } catch(_) {}
    function pulseColor(t){
      // Prefer Calm wireframe state if available
      let sceneHue = null; let sceneFlash = null; let sceneRgb = null; let sceneIntensity = null; let hasWF = false;
      let syntheticFlashActive = null;
      try {
        // Highest priority: direct Calm getter if present
        let wf = null;
        if (typeof window.__getCalmWireframeState === 'function') {
          wf = window.__getCalmWireframeState();
        } else if (window._calmPlugin && typeof window._calmPlugin.getWireframeState === 'function') {
          wf = window._calmPlugin.getWireframeState();
        } else if (window._engine && window._engine.currentPlugin && typeof window._engine.currentPlugin.getWireframeState === 'function') {
          wf = window._engine.currentPlugin.getWireframeState();
        }
        if (wf) {
          hasWF = true;
          if (typeof wf.hueDeg === 'number') sceneHue = wf.hueDeg;
          if (typeof wf.flash === 'number') sceneFlash = wf.flash;
          if (wf.rgb && typeof wf.rgb.r === 'number') sceneRgb = wf.rgb;
          if (typeof wf.intensity === 'number') sceneIntensity = Math.max(0, Math.min(1, wf.intensity));
        }
        // Fallback to Calm globals if plugin state is unavailable
        if (!hasWF && typeof window !== 'undefined') {
          if (typeof window._coreHueDeg === 'number') sceneHue = window._coreHueDeg;
          if (typeof window._corePulse === 'number') sceneIntensity = Math.max(0, Math.min(1, window._corePulse));
          if (typeof window._corePulseStep === 'number') sceneFlash = window._corePulseStep;
        }
        // Always read from Three.js scene by object name (authoritative if present)
        {
          const eng = window._engine;
          const obj = eng && eng.scene && typeof eng.scene.getObjectByName === 'function'
            ? eng.scene.getObjectByName('CalmCoreWire')
            : null;
          if (obj && obj.material) {
            const m = obj.material;
            if (typeof m.opacity === 'number') sceneIntensity = Math.max(0, Math.min(1, m.opacity));
            if (m.color) {
              const c = m.color;
              const max = Math.max(c.r, c.g, c.b), min = Math.min(c.r, c.g, c.b);
              let h = 200; const d = max - min;
              if (d > 1e-5) {
                if (max === c.r) h = ((c.g - c.b) / d) % 6;
                else if (max === c.g) h = (c.b - c.r) / d + 2;
                else h = (c.r - c.g) / d + 4;
                h *= 60; if (h < 0) h += 360;
              }
              sceneHue = h;
              sceneRgb = { r: Math.round(c.r*255), g: Math.round(c.g*255), b: Math.round(c.b*255) };
            }
          }
        }
      } catch(_) {}

      // If Calm is not providing state, synthesize it using the same style as Calm core
      const synthNeeded = !hasWF;
      if (synthNeeded) {
        // Synthetic color base (Calm core blue range)
        const tsec = t;
        const phase = 0.5 + 0.5*Math.sin(tsec * 0.60 * 2.0); // warpSpeed ~0.60
        const cO = { r: 0x58/255, g: 0xb7/255, b: 0xff/255 };
        const cI = { r: 0xa5/255, g: 0xf0/255, b: 0xff/255 };
        let baseR = (cO.r + (cI.r - cO.r) * phase) * 255;
        let baseG = (cO.g + (cI.g - cO.g) * phase) * 255;
        let baseB = (cO.b + (cI.b - cO.b) * phase) * 255;

        const nowMs = (typeof performance !== 'undefined') ? performance.now() : Date.now();
        const dt = Math.max(0, (nowMs - lastMs) / 1000);
        lastMs = nowMs;
        // Non-uniform threshold with noise; irregular but no scheduler
        const n = Math.sin(tsec*0.73 + noiseSeed) * 0.08; // slow noise
        const fast = Math.sin(tsec * 6.0 + Math.sin(tsec*1.5+noiseSeed)*0.33);
        const thr = 0.78 + n; // 0.70..0.86 jitter
        const isFlash = fast > thr;
        // Warm flash palette (yellow/orange/red blend)
        const warmMix = 0.5 + 0.5*Math.sin(tsec*3.1 + noiseSeed);
        const warmR = (0xff*(1-warmMix) + 0xff*warmMix);
        const warmG = (0xd2*(1-warmMix) + 0x4d*warmMix);
        const warmB = (0x4d*(1-warmMix) + 0x4d*warmMix);
        sceneRgb = isFlash
          ? { r: Math.round(warmR), g: Math.round(warmG), b: Math.round(warmB) }
          : { r: Math.round(baseR), g: Math.round(baseG), b: Math.round(baseB) };
        // Sharp rise/decay to targets
        const target = isFlash ? 0.28 : 0.10;
        const k = isFlash ? 22.0 : 12.0;
        flashLevel += (target - flashLevel) * (1 - Math.exp(-k*dt));
        const micro = Math.sin(tsec*37 + noiseSeed*2.3) * 0.012;
        sceneFlash = flashLevel + micro;
        syntheticFlashActive = isFlash;
        // Do not return here; continue to compute stroke below
      }

      // Visibility: if calmPulse window is active and carries intensity, use it strictly
      const now = (typeof performance !== 'undefined') ? performance.now() : Date.now();
      if (now < (pulseUntilMs||0) && typeof pulseIntensity === 'number') {
        // Step-like flash: no tails, slightly higher base
        const a = 0.16 + 0.22 * Math.max(0, Math.min(1, pulseIntensity));
        const hue = pulseHueDeg || 200;
        // Convert hue to RGB
        const H = ((hue % 360) + 360) % 360, S = 0.90, L = 0.70;
        const C = (1-Math.abs(2*L-1))*S; const X = C*(1-Math.abs(((H/60)%2)-1)); const m=L-C/2;
        let r1=0,g1=0,b1=0; const hSeg=Math.floor(H/60);
        if (hSeg===0){r1=C;g1=X;b1=0;} else if (hSeg===1){r1=X;g1=C;b1=0;} else if (hSeg===2){r1=0;g1=C;b1=X;} else if (hSeg===3){r1=0;g1=X;b1=C;} else if (hSeg===4){r1=X;g1=0;b1=C;} else {r1=C;g1=0;b1=X;}
        const rr = Math.round((r1+m)*255), gg = Math.round((g1+m)*255), bb = Math.round((b1+m)*255);
        return { stroke: `rgba(${rr},${gg},${bb},${a.toFixed(3)})`, p: 0, flashActive: true, alpha: a, hue: hue, intensity: pulseIntensity };
      }

      // Visibility: if we have sceneFlash as numeric alpha, use it; else step-only baseline
      let step = (typeof window !== 'undefined' && typeof window._corePulseStep === 'number') ? window._corePulseStep : null;
      let alpha;
      if (typeof sceneIntensity === 'number') {
        // Baseline strictly tied to Calm intensity (no randoms) ‚Äî slightly higher base
        alpha = 0.22 + 0.16 * sceneIntensity;
      } else {
        if (sceneFlash != null) step = sceneFlash;
        alpha = (step === 0 || step === 1) ? (step === 1 ? 0.65 : 0.24) : 0.24;
      }

      // Stroke color
      const computedFlashActive = (syntheticFlashActive !== null) ? syntheticFlashActive : (!!step);
      if (sceneRgb) {
        const { r, g, b } = sceneRgb;
        return { stroke: `rgba(${r},${g},${b},${alpha.toFixed(3)})`, p: 0, flashActive: computedFlashActive, alpha, hue: sceneHue, intensity: sceneIntensity };
      }

      // Fallback to hue
      const baseHue = (sceneHue != null) ? sceneHue : 200;
      const H = ((baseHue % 360) + 360) % 360, S = 0.90, L = 0.70;
      const C = (1-Math.abs(2*L-1))*S; const X = C*(1-Math.abs(((H/60)%2)-1)); const m=L-C/2;
      let r1=0,g1=0,b1=0; const hSeg=Math.floor(H/60);
      if (hSeg===0){r1=C;g1=X;b1=0;} else if (hSeg===1){r1=X;g1=C;b1=0;} else if (hSeg===2){r1=0;g1=C;b1=X;} else if (hSeg===3){r1=0;g1=X;b1=C;} else if (hSeg===4){r1=X;g1=0;b1=C;} else {r1=C;g1=0;b1=X;}
      const rr = Math.round((r1+m)*255), gg = Math.round((g1+m)*255), bb = Math.round((b1+m)*255);
      return { stroke: `rgba(${rr},${gg},${bb},${alpha.toFixed(3)})`, p: 0, flashActive: computedFlashActive, alpha, hue: baseHue, intensity: sceneIntensity };
    }
    function drawCanvasGrid(t){
      try {
        if (!ctx) return;
        const vw = window.innerWidth, vh = window.innerHeight;
        // Ensure canvas matches viewport even when HUD is inactive (for crosshair)
        const dpr = window.devicePixelRatio || 1;
        const needResize = canvas.width !== Math.floor(vw * dpr) || canvas.height !== Math.floor(vh * dpr);
        if (needResize) {
          canvas.width = Math.floor(vw * dpr);
          canvas.height = Math.floor(vh * dpr);
          canvas.style.width = vw + 'px';
          canvas.style.height = vh + 'px';
          ctx = canvas.getContext('2d');
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        ctx.clearRect(0,0,vw,vh);
        const pc = pulseColor(t/1000);
        const nowFlash = !!pc.flashActive;
        prevFlashActive = nowFlash;
        const hudOrLinks = isGridActive();
        // Base border color #243041 with reduced opacity
        const baseBorderColor = 'rgba(36,48,65,0.35)'; // reduced visibility
        const flashColor = 'rgba(91,156,255,0.27)'; // very subtle flash, barely noticeable
        ctx.lineWidth = 1;
        if (hudOrLinks) {
          // Draw grid lines only in HUD/Links mode
          // Solid lines (no dash) with very subtle color flicker during flash (all lines)
          cachedXs.forEach((x,i)=>{
            const seed = lineSeeds.get('x'+i) || 0.5;
            let lineColor = baseBorderColor;
            if (nowFlash) {
              // Very subtle flicker - very slow and barely noticeable
              const freq = 12; // much slower frequency
              const duty = 0.15; // shorter flash duration
              const ph = (t*freq + seed*3) % 1;
              const strobeOn = ph < duty;
              lineColor = strobeOn ? flashColor : baseBorderColor;
            }
            ctx.strokeStyle = lineColor;
            ctx.setLineDash([]); // solid line
            ctx.beginPath();
            // half-pixel align for crispness
            ctx.moveTo(Math.round(x)+0.5, 0);
            ctx.lineTo(Math.round(x)+0.5, vh);
            ctx.stroke();
          });
          cachedYs.forEach((y,i)=>{
            const seed = lineSeeds.get('y'+i) || 0.5;
            let lineColor = baseBorderColor;
            if (nowFlash) {
              // Very subtle flicker - very slow and barely noticeable
              const freq = 12; // much slower frequency
              const duty = 0.15; // shorter flash duration
              const ph = (t*freq + seed*3.7) % 1; // slightly different seed
              const strobeOn = ph < duty;
              lineColor = strobeOn ? flashColor : baseBorderColor;
            }
            ctx.strokeStyle = lineColor;
            ctx.setLineDash([]); // solid line
            ctx.beginPath();
            ctx.moveTo(0, Math.round(y)+0.5);
            ctx.lineTo(vw, Math.round(y)+0.5);
            ctx.stroke();
          });
        }
        // --- Cursor crosshair (subtle) ---
        // Fade crosshair when idle
        // (grid cursor crosshair removed)
        // Debug HUD removed per request
      } catch (_) { /* swallow to keep app alive */ }
      requestAnimationFrame(drawCanvasGrid);
    }

    // Start the draw loop on startup (even outside HUD)
    try { requestAnimationFrame(drawCanvasGrid); } catch(_) {}

    // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞ resize
    let gridTimer;
    window.addEventListener('resize', () => {
      clearTimeout(gridTimer);
      gridTimer = setTimeout(buildGrid, 100);
    });

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è layout HUD (display/–∫–ª–∞—Å—Å—ã/inline-—Å—Ç–∏–ª–∏)
    const moTargets = ['#site-header', '#links-panel', '#hud-container', '#hud-small-panel', '#hud-big-panel', '#mobile-orbit-toggle']
      .map(sel => document.querySelector(sel)).filter(Boolean);
    if (moTargets.length) {
      const mo = new MutationObserver(() => buildGrid());
      moTargets.forEach(t => mo.observe(t, { attributes: true, attributeFilter: ['style', 'class'], subtree: true }));
    }
    // Watch for hud-active class changes on document root
    const hudObserver = new MutationObserver(() => {
      if (isGridActive()) {
        buildGrid();
      } else {
        // Clear grid when HUD is inactive
        if (ctx) {
          const vw = window.innerWidth, vh = window.innerHeight;
          ctx.clearRect(0, 0, vw, vh);
        }
      }
    });
    hudObserver.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
    
    // Resize handler
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        engine.resize(window.innerWidth, window.innerHeight);
      }, 250);
    });
    
    engine.resize(window.innerWidth, window.innerHeight);
    
  } catch (error) {
    console.error('[Bootstrap] ‚ùå Error:', error);
    // Do not replace body; keep app visible for diagnostics
  }
}

init();
</script>
</body>
</html>

